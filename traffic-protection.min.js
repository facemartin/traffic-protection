!function(){let e=document.currentScript;if(!e){const t=document.getElementsByTagName("script");for(let n=0;n<t.length;n++)if(t[n].src.includes("traffic-protection")){e=t[n];break}}const t={clickThreshold:parseInt(e?e.getAttribute("data-threshold"):"3",10)||3,timeWindow:parseInt(e?e.getAttribute("data-timewindow"):"10000",10)||10000,cookieExpiry:parseInt(e?e.getAttribute("data-expiry"):"86400",10)||86400,redirectDelay:parseInt(e?e.getAttribute("data-delay"):"1500",10)||1500,adClickThreshold:parseInt(e?e.getAttribute("data-ad-threshold"):"2",10)||2,adTimeWindow:parseInt(e?e.getAttribute("data-ad-timewindow"):"60000",10)||60000,redirectUrl:e&&e.getAttribute("data-redirect")?e.getAttribute("data-redirect"):"https://ecrm.police.go.kr/minwon/main",botDetectionEnabled:e?e.getAttribute("data-bot-detection")!=="false":true},n={state:{clickCount:0,lastClickTime:0,redirectBlocked:false,visitLogged:false,adClickCount:0,lastAdClickTime:0,botScore:0,lastClickX:0,lastClickY:0,lastClickInterval:0},init:function(){if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",()=>{this.initAfterDOMReady()})}else{this.initAfterDOMReady()}},initAfterDOMReady:function(){this.checkPreviousVisit();document.addEventListener("click",this.handleClick.bind(this));window.addEventListener("beforeunload",this.logVisit.bind(this));if(t.botDetectionEnabled){this.initBotDetection()}this.monitorAdClicks();this.setupLinkProtection();console.log("TrafficProtection 초기화 완료. 설정:",t)},checkPreviousVisit:function(){const e=this.getCookie("lastVisit");if(e){const t=parseInt(e,10);const n=Date.now();if(n-t<5e3){this.state.redirectBlocked=true;console.warn("빠른 재방문 감지: 리다이렉트 제한됨");this.state.botScore+=30}}},handleClick:function(e){const n=Date.now();if(n-this.state.lastClickTime>t.timeWindow){this.state.clickCount=0}this.state.clickCount++;this.state.lastClickTime=n;console.log(`클릭 감지: ${this.state.clickCount}/${t.clickThreshold+1}`);if(this.state.clickCount>t.clickThreshold){this.state.redirectBlocked=true;console.warn("과도한 클릭 감지: 리다이렉트 제한됨");this.state.botScore+=20;this.setCookie("clickLimit","true",t.cookieExpiry)}this.analyzeClickPattern(e)},logVisit:function(){if(this.state.visitLogged)return;this.setCookie("lastVisit",Date.now().toString(),t.cookieExpiry);this.state.visitLogged=true;if(this.state.botScore>50){this.setCookie("botSuspect","true",t.cookieExpiry)}},handleRedirect:function(e){console.log("리다이렉트 처리:",e);console.log("차단 상태:",this.state.redirectBlocked);console.log("쿠키 clickLimit:",this.getCookie("clickLimit"));console.log("쿠키 botSuspect:",this.getCookie("botSuspect"));if(this.state.redirectBlocked||this.getCookie("clickLimit")==="true"||this.getCookie("botSuspect")==="true"){console.warn("리다이렉트 차단됨: 무효 트래픽 의심");setTimeout(()=>{window.location.href=t.redirectUrl},500);return false}setTimeout(()=>{window.location.href=e},t.redirectDelay);return true},setCookie:function(e,t,n){const i=new Date;i.setTime(i.getTime()+n*1e3);const o="expires="+i.toUTCString();document.cookie=e+"="+t+";"+o+";path=/";console.log(`쿠키 설정: ${e}=${t}, 만료: ${n}초`)},getCookie:function(e){const t=e+"=";const n=document.cookie.split(";");for(let i=0;i<n.length;i++){let o=n[i].trim();if(o.indexOf(t)===0){return o.substring(t.length,o.length)}}return""},initBotDetection:function(){let e=0;document.addEventListener("mousemove",()=>{e++});setTimeout(()=>{if(e<5){this.state.botScore+=15;console.log("마우스 움직임 적음: 봇 점수 증가",this.state.botScore)}},5e3);let t=0;document.addEventListener("scroll",()=>{t++},{passive:true});setTimeout(()=>{if(t<2){this.state.botScore+=10;console.log("스크롤 적음: 봇 점수 증가",this.state.botScore)}},8e3);this.checkBrowserFingerprint()},checkBrowserFingerprint:function(){const e=navigator.userAgent.toLowerCase();if(e.includes("headless")||e.includes("phantomjs")||e.includes("selenium")){this.state.botScore+=50;console.log("자동화 도구 감지: 봇 점수 증가",this.state.botScore)}if(window.innerWidth<100||window.innerHeight<100){this.state.botScore+=20;console.log("비정상 화면 크기: 봇 점수 증가",this.state.botScore)}if(navigator.webdriver){this.state.botScore+=50;console.log("WebDriver 감지: 봇 점수 증가",this.state.botScore)}},analyzeClickPattern:function(e){if(this.state.lastClickX===e.clientX&&this.state.lastClickY===e.clientY){this.state.botScore+=10;console.log("동일 위치 클릭: 봇 점수 증가",this.state.botScore)}const t=Date.now()-this.state.lastClickTime;if(this.state.lastClickInterval&&Math.abs(this.state.lastClickInterval-t)<50){this.state.botScore+=15;console.log("규칙적 클릭 간격: 봇 점수 증가",this.state.botScore)}this.state.lastClickX=e.clientX;this.state.lastClickY=e.clientY;this.state.lastClickInterval=t},monitorAdClicks:function(){const e=()=>{const e=["ins.adsbygoogle",".google-ad",".adsbygoogle",".google-ads",".ad-wrapper",'[id*="google_ads"]','[class*="google-ad"]','[id*="googlead"]'];e.forEach(e=>{const t=document.querySelectorAll(e);t.forEach(e=>{e.addEventListener("click",this.handleAdClick.bind(this));console.log("광고 요소에 클릭 리스너 추가:",e)})});this.observeNewAds()};if(document.readyState==="loading"){window.addEventListener("load",e)}else{e()}},handleAdClick:function(e){const n=Date.now();if(n-this.state.lastAdClickTime>t.adTimeWindow){this.state.adClickCount=0}this.state.adClickCount++;this.state.lastAdClickTime=n;console.log(`광고 클릭 감지: ${this.state.adClickCount}/${t.adClickThreshold+1}`);if(this.state.adClickCount>t.adClickThreshold){console.warn("과도한 광고 클릭 감지");this.state.botScore+=40;this.setCookie("adClickLimit","true",t.cookieExpiry);if(this.getCookie("adClickLimit")==="true"){e.preventDefault();e.stopPropagation();return false}}},observeNewAds:function(){if(!window.MutationObserver)return;const e=new MutationObserver(e=>{e.forEach(e=>{if(e.addedNodes&&e.addedNodes.length>0){for(let t=0;t<e.addedNodes.length;t++){const n=e.addedNodes[t];if(n.nodeType===1){if(n.classList&&(n.classList.contains("adsbygoogle")||n.classList.contains("google-ad")||n.classList.contains("google-ads"))){n.addEventListener("click",this.handleAdClick.bind(this));console.log("동적 광고 요소에 클릭 리스너 추가")}const e=n.querySelectorAll('.adsbygoogle, .google-ad, .google-ads, [id*="google_ads"], [class*="google-ad"], [id*="googlead"]');e.forEach(e=>{e.addEventListener("click",this.handleAdClick.bind(this));console.log("동적 광고 하위 요소에 클릭 리스너 추가")})}}}})});e.observe(document.body,{childList:true,subtree:true});console.log("동적 광고 요소 감시 시작")},setupLinkProtection:function(){const e=()=>{const e=document.querySelectorAll('a[href^="http"]');e.forEach(e=>{if(!e.href.includes(window.location.hostname)){e.addEventListener("click",t=>{t.preventDefault();console.log("외부 링크 클릭 감지:",e.href);this.handleRedirect(e.href)})}});console.log("외부 링크 보호 설정 완료")};if(document.readyState==="loading"){window.addEventListener("load",e)}else{e()}},debug:function(){console.log("TrafficProtection 상태:",this.state);console.log("설정:",t);console.log("쿠키 clickLimit:",this.getCookie("clickLimit"));console.log("쿠키 botSuspect:",this.getCookie("botSuspect"));console.log("쿠키 lastVisit:",this.getCookie("lastVisit"));console.log("쿠키 adClickLimit:",this.getCookie("adClickLimit"))}};n.init();window.TrafficProtection=n}();
