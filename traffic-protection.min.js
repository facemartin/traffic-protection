!function(){let t=document.currentScript,e={clickThreshold:parseInt(t.getAttribute("data-threshold")||"3",10),timeWindow:parseInt(t.getAttribute("data-timewindow")||"10000",10),cookieExpiry:parseInt(t.getAttribute("data-expiry")||"86400",10),redirectDelay:parseInt(t.getAttribute("data-delay")||"1500",10),adClickThreshold:parseInt(t.getAttribute("data-ad-threshold")||"2",10),adTimeWindow:parseInt(t.getAttribute("data-ad-timewindow")||"60000",10),redirectUrl:t.getAttribute("data-redirect")||"https://ecrm.police.go.kr/minwon/main",botDetectionEnabled:"false"!==t.getAttribute("data-bot-detection")},i={state:{clickCount:0,lastClickTime:0,redirectBlocked:!1,visitLogged:!1,adClickCount:0,lastAdClickTime:0,botScore:0,lastClickX:0,lastClickY:0,lastClickInterval:0},init:function(){this.checkPreviousVisit(),document.addEventListener("click",this.handleClick.bind(this)),window.addEventListener("beforeunload",this.logVisit.bind(this)),e.botDetectionEnabled&&this.initBotDetection(),this.monitorAdClicks(),this.setupLinkProtection()},checkPreviousVisit:function(){let t=this.getCookie("lastVisit");if(t){let e=parseInt(t,10),i=Date.now();i-e<5e3&&(this.state.redirectBlocked=!0,console.warn("빠른 재방문 감지: 리다이렉트 제한됨"),this.state.botScore+=30)}},handleClick:function(t){let i=Date.now();i-this.state.lastClickTime>e.timeWindow&&(this.state.clickCount=0),this.state.clickCount++,this.state.lastClickTime=i,this.state.clickCount>e.clickThreshold&&(this.state.redirectBlocked=!0,console.warn("과도한 클릭 감지: 리다이렉트 제한됨"),this.state.botScore+=20,this.setCookie("clickLimit","true",e.cookieExpiry)),this.analyzeClickPattern(t)},logVisit:function(){!this.state.visitLogged&&(this.setCookie("lastVisit",Date.now().toString(),e.cookieExpiry),this.state.visitLogged=!0,this.state.botScore>50&&this.setCookie("botSuspect","true",e.cookieExpiry))},handleRedirect:function(t){return this.state.redirectBlocked||"true"===this.getCookie("clickLimit")||"true"===this.getCookie("botSuspect")?(console.warn("리다이렉트 차단됨: 무효 트래픽 의심"),setTimeout(()=>{window.location.href=e.redirectUrl},500),!1):(setTimeout(()=>{window.location.href=t},e.redirectDelay),!0)},setCookie:function(t,e,i){let s=new Date;s.setTime(s.getTime()+1e3*i);let o="expires="+s.toUTCString();document.cookie=t+"="+e+";"+o+";path=/"},getCookie:function(t){let e=t+"=",i=document.cookie.split(";");for(let s=0;s<i.length;s++){let o=i[s].trim();if(0===o.indexOf(e))return o.substring(e.length,o.length)}return""},initBotDetection:function(){let t=0;document.addEventListener("mousemove",()=>{t++}),setTimeout(()=>{t<5&&(this.state.botScore+=15)},5e3);let e=0;document.addEventListener("scroll",()=>{e++},{passive:!0}),setTimeout(()=>{e<2&&(this.state.botScore+=10)},8e3),this.checkBrowserFingerprint()},checkBrowserFingerprint:function(){let t=navigator.userAgent.toLowerCase();(t.includes("headless")||t.includes("phantomjs")||t.includes("selenium"))&&(this.state.botScore+=50),(window.innerWidth<100||window.innerHeight<100)&&(this.state.botScore+=20),navigator.webdriver&&(this.state.botScore+=50)},analyzeClickPattern:function(t){this.state.lastClickX===t.clientX&&this.state.lastClickY===t.clientY&&(this.state.botScore+=10);let e=Date.now()-this.state.lastClickTime;this.state.lastClickInterval&&50>Math.abs(this.state.lastClickInterval-e)&&(this.state.botScore+=15),this.state.lastClickX=t.clientX,this.state.lastClickY=t.clientY,this.state.lastClickInterval=e},monitorAdClicks:function(){window.addEventListener("load",()=>{["ins.adsbygoogle",".google-ad",".adsbygoogle",".google-ads",".ad-wrapper",'[id*="google_ads"]','[class*="google-ad"]','[id*="googlead"]'].forEach(t=>{let e=document.querySelectorAll(t);e.forEach(t=>{t.addEventListener("click",this.handleAdClick.bind(this))})}),this.observeNewAds()})},handleAdClick:function(t){let i=Date.now();if(i-this.state.lastAdClickTime>e.adTimeWindow&&(this.state.adClickCount=0),this.state.adClickCount++,this.state.lastAdClickTime=i,this.state.adClickCount>e.adClickThreshold&&(console.warn("과도한 광고 클릭 감지"),this.state.botScore+=40,this.setCookie("adClickLimit","true",e.cookieExpiry),"true"===this.getCookie("adClickLimit")))return t.preventDefault(),t.stopPropagation(),!1},observeNewAds:function(){if(!window.MutationObserver)return;let t=new MutationObserver(t=>{t.forEach(t=>{if(t.addedNodes&&t.addedNodes.length>0)for(let e=0;e<t.addedNodes.length;e++){let i=t.addedNodes[e];if(1===i.nodeType){i.classList&&(i.classList.contains("adsbygoogle")||i.classList.contains("google-ad")||i.classList.contains("google-ads"))&&i.addEventListener("click",this.handleAdClick.bind(this));let s=i.querySelectorAll('.adsbygoogle, .google-ad, .google-ads, [id*="google_ads"], [class*="google-ad"], [id*="googlead"]');s.forEach(t=>{t.addEventListener("click",this.handleAdClick.bind(this))})}}})});t.observe(document.body,{childList:!0,subtree:!0})},setupLinkProtection:function(){window.addEventListener("load",()=>{let t=document.querySelectorAll('a[href^="http"]');t.forEach(t=>{t.href.includes(window.location.hostname)||t.addEventListener("click",e=>{e.preventDefault(),this.handleRedirect(t.href)})})})}};i.init(),window.TrafficProtection=i}();
